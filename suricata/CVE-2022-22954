######################################################################################################################

https://www.rapid7.com/blog/post/2022/04/29/widespread-exploitation-of-vmware-workspace-one-access-cve-2022-22954/
https://blog.morphisec.com/vmware-identity-manager-attack-backdoor
https://github.com/lucksec/VMware-CVE-2022-22954/blob/main/VMware%20CVE-2022-22954.py
Observed GET -> /catalog-portal/ui/oauth/verify?error=&deviceUdid=${"freemarker.template.utility.Execute"?new()("COMAND TO EXECUTE")}

######################################################################################################################

# Hits for the GET in the URI

	alert tcp $EXTERNAL_NET any -> $HOME_NET any(msg:"CVE-2022-22954 GET Observed"; \
	flow:to_server, established; \
	content:"GET"; http_method; \
	content:"catalog|2d|portal|2f|ui|2f|oauth|2f|verify|3f|error|3d 26|deviceUdid|3d|"; http.uri; \
	priority:2; \
	metadata: Not tested for FP rate or accuracy; \
	reference:url,https://www.rapid7.com/blog/post/2022/04/29/widespread-exploitation-of-vmware-workspace-one-access-cve-2022-22954/,CVE-2022-22954; \
	sid:1000012; rev:1;) \
		
		
# Probably a duplicate to the rule above, just a different string in the original URI

	alert tcp $EXTERNAL_NET any -> $HOME_NET any(msg:"CVE-2022-22954 GET Observed"; \
	flow:to_server, established; \
	content:"POST"; http_method; \
	content:"|24 7b 22|freemarker|2e|template|2e|utility|2e|Execute"; http.uri; \
	priority:2; \
	metadata: Not tested for FP rate or accuracy; \
	reference:url,https://www.rapid7.com/blog/post/2022/04/29/widespread-exploitation-of-vmware-workspace-one-access-cve-2022-22954/,CVE-2022-22954; \
	sid:1000013; rev:1;) \


# Way Forward
