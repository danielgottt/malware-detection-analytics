
https://github.com/Dec0ne/KrbRelayUp
https://github.com/dirkjanm/krbrelayx
https://twitter.com/sbousseaden/status/1518976397364056071?s=12&t=qKO5eKHvWhAP19a50FTZ7g


SELECT strftime('%Y-%m-%d %H:%M:%S',datetime(time,'unixepoch')) AS datetime, eventid,
JSON_EXTRACT(data, '$.EventData.TargetUserName') AS username, 
JSON_EXTRACT(data, '$.EventData.WorkstationName') AS source_machine_network, 
JSON_EXTRACT(data, '$.EventData.IpAddress') AS source_ip,
JSON_EXTRACT(data, '$.EventData.IpPort') AS source_port, 
JSON_EXTRACT(data, '$.EventData.ProcessName') AS process_name, 
JSON_EXTRACT(data, '$.EventData.LogonType') AS logon_type,
JSON_EXTRACT(data, '$.EventData.LogonProcessName') AS login_method,
JSON_EXTRACT(data, '$.EventData.TargetUserSid') AS user_SID,
JSON_EXTRACT(data, '$.EventData.LmPackageName') AS lmpackagename
FROM windows_events 
WHERE eventid = 4624 AND time > strftime('%s', 'now', '-72 hours')
AND logon_type = '3' AND login_method = 'Kerberos' AND source_ip = '127.0.0.1' AND (source_port = '0' OR source_port = '12345')

-- Currently looks for the defaults, could potentially restrict the source port to things below ephemeral (source_port <= '50000')
