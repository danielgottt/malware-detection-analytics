title: Credential harvest via keymgr.dll
id: 8ab2d882-560e-4d56-924f-2e218893dc78
description: | 
    Detects an attempt to call the keymgr.dll, specifically the function "KRShowKeyMgr"
    Threat actors can leverage this to extract all the stored passwords on a Windows host
references:
  - https://twitter.com/ninjaparanoid/status/1516442028963659777
  - https://twitter.com/0gtweet/status/1415671356239216653
status: experimental
Author: '@gott_cyber'
date: 2022/08/12
tags:
  - attack.credential_access
  - attack.t1003
logsource:
  category: process_creation
  product: windows
detection:
    rundll32:
        Image|endswith: '\rundll32.exe'
    selection_1:
        CommandLine|contains:
            - '/keymgr.dll'
            - '/keymgr'
    selection_2:
        CommandLine|contains:
            - '/KRShowKeyMgr'
            - '/keymgr,KRShowKeyMgr'
    condition: rundll32 and 1 of selection_*
falsepositives:
    - Legitimate admin activities, but thats kinda weird
level: medium
